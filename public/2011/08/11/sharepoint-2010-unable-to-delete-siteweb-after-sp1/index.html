<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SharePoint 2010: Unable to delete site/web after SP1 &ndash; JonTheNerd</title>
    </head>

<body>
    
    <nav>
    <a href="/">JonTheNerd</a>
    <ul>
        <li><a href="/about">About</a></li>
    </ul>
</nav>
    
<h1>SharePoint 2010: Unable to delete site/web after SP1</h1>
<p>While doing some testing after upgrading my dev machine to SP1, I ran into two
separate issues when trying to delete a web through the UI by using the &ldquo;Sites
and Workspaces&rdquo; link in Site Settings. Deleting through powershell worked fine.</p>
<p><!-- raw HTML omitted -->Issue #1: Specified method is not
supported<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>This specific error was occurring only on one of my web applications. I had just
attached the database for this application to my existing SharePoint 2010 SP1
environment. The error will appear if the database for your web application
needs to be updated.</p>
<p>To check if your database needs to be updated, open Central Administration and
navigate to &ldquo;Upgrade and Migration&rdquo; -&gt; &ldquo;Review database status&rdquo;. All of your
databases should show a status of &ldquo;No action required&rdquo;. If the application you
are experiencing the error on is running in compatibility mode, you&rsquo;ll need to
update it using PowerShell. To do this, first get the GUID ID of the database in
question by running the following powershell and then copying the ID of the
database you wish to upgrade:</p>
<p>[code lang=&ldquo;ps&rdquo;]Get-SPContentDatabase[/code]</p>
<p>Then run the following powershell to upgrade the database using the ID you just
copied.</p>
<p>[code lang=&ldquo;ps&rdquo;]Upgrade-SPContentDatabase -Identity
YourDatabaseIDGoesHere[/code]</p>
<p><!-- raw HTML omitted -->Issue #2: There is no Web named &ldquo;/YourWebName&rdquo;<!-- raw HTML omitted --></p>
<p>Once my above issue was resolved on the one misbehaving web application, I had
consistent behavior across all web applications when trying to delete a web&hellip;
or so I thought. Turns out - if I create a web right off of the site collection
(the RootWeb), then I can successfully delete it using the &ldquo;Sites and
Workspaces&rdquo; page. Also - I can delete the web successfully if I navigate to the
web I want to delete and then use the &ldquo;Delete this Site&rdquo; link. This behavior was
consistent in a SharePoint 2010 SP1 environment <!-- raw HTML omitted -->and<!-- raw HTML omitted --> SharePoint
2010 SP1 + June Cumulative Update. What&rsquo;s going on here?</p>
<p>Time to open up Reflector. The offending code comes from the
Microsoft.SharePoint.ApplicationPages dll located in the virtual
directory/_app_bin of your web application. Specifically, the DeleteWebPage
class.</p>
<p>The offending line, using the OpenWeb function, gets passed &ldquo;/DeleteMe&rdquo; if your
web&rsquo;s name is &ldquo;DeleteMe&rdquo;. This will work fine if the web&rsquo;s url starting from the
site collection is &ldquo;/DeleteMe&rdquo;. But if your web is a subweb of a subweb (e.g.
http://yoursite/someweb/DeleteMe) then it will fail and throw the exception.
This looks to be a bug in SP1 and June CU&hellip; so we&rsquo;ll have to wait for MS to fix
the issue before we can go this route to delete a web. Instead - use PowerShell
to delete the web or navigate to the web you wish to delete and use the &ldquo;Delete
this Site&rdquo; link.</p>

    
    
    
</body>

</html>
