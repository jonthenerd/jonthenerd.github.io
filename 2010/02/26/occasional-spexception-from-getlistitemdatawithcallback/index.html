<!DOCTYPE html>
<html lang="en">
    <head prefix="og: http://ogp.me/ns#">
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>Occasional SPException from GetListItemDataWithCallback &ndash; JonTheNerd</title>
        <meta name="description" content="Wrote a new field control today (SharePoint) that queried a specific list in another site collection based on the value of a field from the current list item. This worked great each time I&rsquo;d test it out and add some additional functionality. When I finished the control, I did a little harder testing by hitting the refresh button in my browser over and over again. Randomly, my control wouldn&rsquo;t render. Other times it would be fine." />
        <meta name="color-scheme" content="dark light" />
        <script>
            
            if (window.matchMedia("(prefers-color-scheme: dark)").media ==="not all") {
                document.documentElement.style.display = "none";
                document.head.insertAdjacentHTML(
                    "beforeend",
                    '<link rel="stylesheet" href="/assets/light.css" onload="document.documentElement.style.display = \'\'">'
                );
            }
        </script>
        <link rel="stylesheet" media="(prefers-color-scheme: light)" href="/assets/light.css" />
        <link rel="stylesheet" media="(prefers-color-scheme: dark)" href="/assets/dark.css" />
        <link rel="stylesheet" href="/assets/style.css" />
        
        <script src="/assets/scripts/main.js" defer></script>
        <link rel="canonical" href="http://www.jonthenerd.com/2010/02/26/occasional-spexception-from-getlistitemdatawithcallback/">
    </head>
    <body>
        <header class="site-header">
    <h1>
        <a href="/">JonTheNerd</a>
    </h1>
    <nav>
        <ul>
            <li><a href="/about">About</a></li>
        </ul>
    </nav>
</header>

        <main>
            
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="name headline">
            <div class="container">Occasional SPException from GetListItemDataWithCallback</div>
        </h1>
        <div class="post-meta">
            <div class="container">
                <time datetime=" 2010-02-26" itemprop="datePublished">February 26, 2010</time>
                by <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <a itemprop="url" href="/about"><span itemprop="name">Jon Badgett</span></a>
                </span>
                
                | Posted in
                <a
                    href="/categories/programming">Programming</a>
                
                
                | Tagged with
                <a
                    href="/tags/sharepoint">SharePoint</a>
                
            </div>
        </div>
    </header>
    <div itemprop="articleBody">
        <div class="container">
            <p>Wrote a new field control today (SharePoint) that queried a specific list in
another site collection based on the value of a field from the current list
item. This worked great each time I&rsquo;d test it out and add some additional
functionality. When I finished the control, I did a little harder testing by
hitting the refresh button in my browser over and over again. Randomly, my
control wouldn&rsquo;t render. Other times it would be fine. What&rsquo;s up with
that?</p>
<p>If you Google it enough, you&rsquo;ll find that this message
generally appears when your CAML is malformed. Well - I used an XmlWriter to
build my CAML query (that way my inserted value from the item would be escaped
properly for XML), so surely my CAML must be fine if it&rsquo;s working most times???
Right??? Nope. The XmlWriter by default puts in a processing instruction on the
first line:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;xml</span> <span class="na">version=</span><span class="s">&#34;1.0&#34;</span> <span class="na">encoding=</span><span class="s">&#34;UTF-8&#34;</span> <span class="err">?</span><span class="nt">&gt;</span>
</span></span></code></pre></div><p>Remove this first line and the field controls render each time without error. The specific error I was receiving was:</p>
<blockquote>
<blockquote>
<p>Microsoft.SharePoint.SPException was caught
Message=&ldquo;Exception occurred. (Exception from HRESULT: 0x80020009
(DISP_E_EXCEPTION))&rdquo;
Source=&ldquo;Microsoft.SharePoint&rdquo;
ErrorCode=-2147352567
StackTrace:
at Microsoft.SharePoint.Library.SPRequest.GetListItemDataWithCallback(String bstrUrl, String bstrListName, String bstrViewName, String bstrViewXml, SAFEARRAYFLAGS fSafeArrayFlags, ISP2DSafeArrayWriter pSACallback, ISPDataCallback pPagingCallback, ISPDataCallback pSchemaCallback)</p>
</blockquote>
</blockquote>

        </div>
    </div>
</article>

        </main>
        <div class="feedback">
    <div class="container">
        <div id="disqus_thread"></div>
    </div>
</div>
<script>
    var disqus_config = function () {
        this.page.url = "http:\/\/www.jonthenerd.com\/2010\/02\/26\/occasional-spexception-from-getlistitemdatawithcallback\/";  
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = 'https://jonthenerd.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        s.setAttribute("defer", "defer");
        (d.head || d.body).appendChild(s);
    })();
</script>


        <footer>
    <div class="container">
        built with <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/jonthenerd/jonthenerd.github.io">GitHub Pages</a> | <a href="/license">License</a> | <span id="theme-toggle" role="button"></span>
    </div>
</footer>

    </body>
</html>
